#!/bin/bash
# Copyright (c) 2025, NVIDIA CORPORATION.  All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Common shell utilities for eidos tools scripts

set -euo pipefail

# Repository root (resolved from any tools/* script)
# shellcheck disable=SC2034  # Used by scripts that source this file
REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

# Color codes for terminal output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No color

# Legacy aliases for backward compatibility (used by scripts that source this file)
# shellcheck disable=SC2034
COLOR_GREEN="${GREEN}"
# shellcheck disable=SC2034
COLOR_RED="${RED}"
# shellcheck disable=SC2034
COLOR_YELLOW="${YELLOW}"
# shellcheck disable=SC2034
COLOR_BLUE="${BLUE}"
# shellcheck disable=SC2034
COLOR_RESET="${NC}"

# Logging functions
log_info() {
    echo -e "${BLUE}â„¹ï¸  $*${NC}"
}

log_success() {
    echo -e "${GREEN}âœ… $*${NC}"
}

log_warning() {
    echo -e "${YELLOW}âš ï¸  $*${NC}"
}

log_error() {
    echo -e "${RED}âŒ $*${NC}"
}

log_debug() {
    if [[ "${DEBUG:-false}" == "true" ]]; then
        echo -e "${BLUE}ðŸ” DEBUG: $*${NC}"
    fi
}

# Legacy logging functions for backward compatibility
err() {
    local message=$1
    printf "${COLOR_RED}[ERR]${COLOR_RESET} %s\n" "$message" >&2
    exit 1
}

msg() {
    local message=$1
    printf "${COLOR_GREEN}[MSG]${COLOR_RESET} %s\n" "$message" >&2
}

# Check if the required tools are installed
has_tools() {
    local tools=("$@")
    for tool in "${tools[@]}"; do
        if ! command -v "$tool" &> /dev/null; then
            err "Required tool ($tool) is not installed."
        fi
    done
}