#!/bin/bash

# Skyhook Operator Installation Script
# Generated by CNS Eidos
# Timestamp: 2026-01-11T16:17:47Z
# Bundler Version: v0.12.4-next

set -e

echo "Installing Skyhook Operator..."

# Create namespace if it doesn't exist
kubectl create namespace skyhook --dry-run=client -o yaml | kubectl apply -f -

# Add Helm repository
echo "Adding Skyhook Helm repository..."
helm repo add skyhook oci://ghcr.io/nvidia/skyhook
helm repo update

# Install Skyhook Operator
echo "Installing Skyhook Operator using Helm..."
helm upgrade --install skyhook skyhook/skyhook \
  --namespace skyhook \
  --create-namespace \
  --values values.yaml \
  --wait

# Wait for operator to be ready
echo "Waiting for Skyhook Operator to be ready..."
kubectl wait --for=condition=available --timeout=300s \
  deployment/skyhook-operator-controller-manager \
  -n skyhook

# Apply Skyhook customizations if manifests directory exists
if [ -d "manifests" ]; then
  echo "Applying Skyhook customizations..."
  kubectl apply -f manifests/
fi

echo "Skyhook Operator installation complete!"
echo ""
echo "To verify the installation:"
echo "  kubectl get pods -n skyhook"
echo "  kubectl get skyhook -A"
echo ""
echo "To view logs:"
echo "  kubectl logs -n skyhook -l control-plane=controller-manager"
