# Skyhook Ubuntu Node Customization
# Generated by Cloud Native Stack
#
# This customization configures GPU nodes with:
# - GRUB parameters for hugepages and nokaslr
# - Containerd service limits
# - Sysctl kernel tuning parameters
---
apiVersion: skyhook.nvidia.com/v1alpha1
kind: Skyhook
metadata:
  labels:
    app.kubernetes.io/part-of: skyhook-operator
    app.kubernetes.io/created-by: skyhook-operator
    app.kubernetes.io/managed-by: cns
    app.kubernetes.io/version: "v0.12.4-next"
  name: ubuntu
  namespace: skyhook
spec:
  runtimeRequired: true
  additionalTolerations:
    -
      operator: Exists
  interruptionBudget:
    percent: 100
  packages:
    tuning:
      configInterrupts:
        grub.conf:
          type: reboot
        service_containerd.conf:
          type: service
          services: ["containerd"]
        sysctl.conf:
          type: reboot
      interrupt: 
        type: reboot
      configMap:
        grub.conf: |-
          hugepagesz=1G
          hugepages=2
          hugepagesz=2M
          hugepages=5128
          nokaslr
        service_containerd.conf: |-
          [Service]
          LimitSTACK=67108864
        sysctl.conf: |-
          fs.inotify.max_user_instances=65535
          fs.inotify.max_user_watches=524288
          kernel.threads-max=16512444
          vm.max_map_count=262144
          vm.min_free_kbytes=65536
          vm.overcommit_memory=1
