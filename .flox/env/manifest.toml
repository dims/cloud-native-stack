# =============================================================================
# Flox Environment Manifest
# =============================================================================
#
# AUTO-GENERATED from .versions.yaml - DO NOT EDIT DIRECTLY
#
# Regenerate with: make flox-manifest
#
# This provides an alternative to 'make tools-setup' for developers who
# prefer Flox/Nix-based development environments.
#
# Usage:
#   flox activate    # Enter the development environment
#   flox install     # Install packages without activating
#
# =============================================================================

version = 1

# Core development tools
[install]
# Language runtime
go.pkg-path = "go"

# Kubernetes tools
kubectl.pkg-path = "kubectl"
kind.pkg-path = "kind"
helm.pkg-path = "kubernetes-helm"

# Build tools
ko.pkg-path = "ko"
goreleaser.pkg-path = "goreleaser"

# Linting
golangci-lint.pkg-path = "golangci-lint"
yamllint.pkg-path = "yamllint"

# Development utilities
yq.pkg-path = "yq-go"
jq.pkg-path = "jq"
curl.pkg-path = "curl"

# Container tools (tilt and ctlptl may need manual install)
# tilt.pkg-path = "tilt"  # May not be in nixpkgs

[vars]
# Project-specific environment variables
EIDOS_DEV = "true"

[hook]
on-activate = '''
# =============================================================================
# Flox Environment Activation Hook
# =============================================================================

echo ""
echo "Eidos Development Environment (Flox)"
echo "====================================="
echo ""

# Version information from .versions.yaml
echo "Configured versions (.versions.yaml):"
echo "  Go:             1.25"
echo "  kubectl:        1.32"
echo "  kind:           0.27.0"
echo "  Helm:           3.17.0"
echo "  ko:             0.18.0"
echo "  goreleaser:     2"
echo "  golangci-lint:  2.6.2"
echo "  yamllint:       1.35.0"
echo ""

# Verify key tools are available
echo "Installed tools:"
if command -v go &> /dev/null; then
    echo "  go:             $(go version | awk '{print $3}')"
else
    echo "  go:             NOT FOUND"
fi

if command -v kubectl &> /dev/null; then
    echo "  kubectl:        $(kubectl version --client -o json 2>/dev/null | jq -r '.clientVersion.gitVersion' 2>/dev/null || echo 'unknown')"
else
    echo "  kubectl:        NOT FOUND"
fi

if command -v helm &> /dev/null; then
    echo "  helm:           $(helm version --short 2>/dev/null || echo 'unknown')"
else
    echo "  helm:           NOT FOUND"
fi

if command -v ko &> /dev/null; then
    echo "  ko:             $(ko version 2>/dev/null || echo 'unknown')"
else
    echo "  ko:             NOT FOUND"
fi

if command -v golangci-lint &> /dev/null; then
    echo "  golangci-lint:  $(golangci-lint --version 2>/dev/null | head -1 | awk '{print $4}')"
else
    echo "  golangci-lint:  NOT FOUND"
fi

echo ""

# Check for tools that may need manual installation
MISSING_TOOLS=()
if ! command -v tilt &> /dev/null; then
    MISSING_TOOLS+=("tilt")
fi
if ! command -v ctlptl &> /dev/null; then
    MISSING_TOOLS+=("ctlptl")
fi

if [[ ${#MISSING_TOOLS[@]} -gt 0 ]]; then
    echo "Note: Some tools may need manual installation:"
    for tool in "${MISSING_TOOLS[@]}"; do
        echo "  - $tool (run: make tools-setup to install)"
    done
    echo ""
fi

echo "Run 'make tools-check' to verify all versions match .versions.yaml"
echo ""
'''

[profile]
common = '''
# Common shell profile settings
export GOPATH="${HOME}/go"
export PATH="${GOPATH}/bin:${PATH}"
'''
